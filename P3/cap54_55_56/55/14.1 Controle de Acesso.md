##  Introdu√ß√£o
Este cap√≠tulo aborda como o sistema operacional implementa pol√≠ticas de seguran√ßa para controlar **quem pode acessar o qu√™**, **de que maneira** e **sob quais condi√ß√µes**. Duas etapas principais:
1. Verificar se o pedido est√° dentro da pol√≠tica de seguran√ßa.
2. Permitir ou negar o acesso com base nessa verifica√ß√£o.

---

##  1. O Problema do Controle de Acesso

### Elementos centrais:
- **Sujeito (subject):** Quem faz o pedido (usu√°rio/processo).
- **Objeto (object):** O que se deseja acessar (arquivo, dispositivo, etc.).
- **Acesso:** Tipo de opera√ß√£o (leitura, escrita, execu√ß√£o...).

üîç O sistema operacional deve tomar decis√µes bin√°rias (sim/n√£o) sobre permiss√µes, baseando-se em sua **pol√≠tica de seguran√ßa**. Isso √© feito por um **reference monitor**, que deve ser:
- Confi√°vel (correto)
- Eficiente
- Abrangente (princ√≠pio da media√ß√£o completa)

---

##  2. Truques com Virtualiza√ß√£o
- **Objetos virtuais** (como mem√≥ria virtual ou dispositivos virtuais) podem ser usados para reduzir a necessidade de verifica√ß√µes repetidas.
- O SO ainda precisa garantir o acesso correto por tr√°s da ilus√£o da virtualiza√ß√£o.

---

##  3. Access Control Lists (ACLs)

### Conceito:
Cada objeto possui uma lista que define quais sujeitos t√™m quais permiss√µes sobre ele.

### Funcionamento:
- O sistema identifica o usu√°rio do processo.
- Busca a ACL associada ao objeto.
- Verifica permiss√µes de leitura, escrita, execu√ß√£o, etc.

### Implementa√ß√£o (Unix Cl√°ssico):
- Usa 9 bits: permiss√µes para **usu√°rio**, **grupo** e **outros**.
- Embutida no inode => acesso r√°pido.

### Vantagens:
 F√°cil descobrir quem pode acessar um recurso.  
 Centraliza controle no objeto.  
 Eficiente em muitos casos (como Unix).

### Desvantagens:
‚ùå Dif√≠cil saber todos os acessos de um usu√°rio.  
‚ùå Gerenciamento em sistemas distribu√≠dos √© complexo.  
‚ùå Listas grandes geram sobrecarga.

---

##  4. Capabilities (Capacidades)

### Conceito:
O sujeito precisa possuir um "token" (capacidade) para acessar um recurso.

### Funcionamento:
- O sistema mant√©m uma lista de capacidades seguras por processo.
- A verifica√ß√£o de acesso √© feita comparando as capacidades dispon√≠veis com o pedido de acesso.

### Vantagens:
 F√°cil limitar privil√©gios de processos.  
 Permite construir sistemas com **princ√≠pio do menor privil√©gio**.  
 Ideal para sistemas com grande volume de objetos.

### Desvantagens:
‚ùå Dif√≠cil saber quem tem acesso a um recurso.  
‚ùå Revoga√ß√£o √© complexa.  
‚ùå Precisa de prote√ß√£o contra falsifica√ß√£o e c√≥pia.

---

##  5. Controle de Acesso Discricion√°rio (DAC) vs. Obrigat√≥rio (MAC)

- **DAC (Discretionary Access Control):** O dono decide as permiss√µes.
- **MAC (Mandatory Access Control):** Uma autoridade central determina e imp√µe as permiss√µes.

 Exemplo t√≠pico: pol√≠ticas militares (Top Secret).

---

## üß† 6. Pr√°ticas de Controle de Acesso

### Padr√µes Importam:
- A maioria dos usu√°rios usa as permiss√µes padr√£o (definidas via `umask`, etc.).

### Android:
- Cada app roda sob um UID pr√≥prio.
- Usa **permission labels** que funcionam como capacidades.
- Modelo h√≠brido com elementos de MAC e DAC.

---

## üß© 7. Controle Baseado em Pap√©is ‚Äì RBAC (Role-Based Access Control)

### Motiva√ß√£o:
Permiss√µes baseadas em fun√ß√µes organizacionais.

### Caracter√≠sticas:
- Pap√©is t√™m permiss√µes; usu√°rios assumem pap√©is.
- Pap√©is podem ser trocados dinamicamente.
- Pode incluir **type enforcement** (controle detalhado de opera√ß√µes por tipo).

### Ferramentas:
- `setuid`, `sudo`, usu√°rios artificiais.
- Exige autentica√ß√£o extra e configura√ß√£o segura.

---

##  8. Perigo: Escalonamento de Privil√©gios

- Um invasor com acesso limitado pode explorar falhas para obter mais privil√©gios.
- Objetivo final: acesso root/superusu√°rio.
- Aten√ß√£o especial a programas `setuid`.

---

##  9. Resumo Final

| Mecanismo      | ACLs                                  | Capabilities                          |
|----------------|----------------------------------------|----------------------------------------|
| Baseado em     | Listas por objeto                      | Tokens por processo                    |
| Verifica√ß√£o    | Por identidade e objeto                | Por posse da capacidade                |
| Melhor para    | Ver quem acessa o qu√™                  | Ver o que um processo pode acessar     |
| Revoga√ß√£o      | Simples (edita ACL)                    | Complexa (exige controle centralizado) |
| Uso comum      | Vis√≠vel ao usu√°rio                     | Interno no SO                          |

### Complementos:
- Sistemas podem combinar ACLs e capabilities para otimizar performance.
- RBAC facilita administra√ß√£o em grandes organiza√ß√µes.
- Implementa√ß√µes pr√°ticas devem equilibrar seguran√ßa, desempenho e usabilidade.

---

##  Refer√™ncias Citadas
- Dennis & van Horn (1966): Primeiros estudos sobre capabilities.
- Ferraiolo & Kuhn (1992): Formaliza√ß√£o do RBAC.
- Enck et al. (2009): Seguran√ßa no Android.
- Ken Thompson (1984): "Reflections on Trusting Trust".


## 10. Exemplos Pr√°ticos

### 10.1 Tipos de Acesso

| Tipo de Acesso | Exemplo Linux                                 |
|----------------|------------------------------------------------|
| Leitura        | `cat arquivo.txt`                             |
| Escrita        | `echo "novo conte√∫do" > arquivo.txt`          |
| Execu√ß√£o       | `./script.sh`                                 |
| Exclus√£o       | `rm arquivo.txt`                              |
| Cria√ß√£o        | `touch novo_arquivo.txt`                      |
| Listagem       | `ls /diretorio`                               |

---

### 10.2 Virtualiza√ß√£o

| Tipo                  | Exemplo                                       |
|-----------------------|-----------------------------------------------|
| Mem√≥ria Virtual       | Cada processo tem seu pr√≥prio espa√ßo de mem√≥ria. |
| Disco Virtual         | VM usa disco simulado como `.vdi` no VirtualBox. |
| GPU Virtual           | Processos podem acessar GPUs isoladas por namespace. |
| Dispositivos Virtuais | `/dev/null`, `/dev/tty` s√£o abstra√ß√µes de dispositivos. |

---

### 10.3 ACL (Access Control List)

| Situa√ß√£o                          | Comando                                 |
|----------------------------------|------------------------------------------|
| Ver ACL                          | `getfacl arquivo.txt`                   |
| Adicionar permiss√£o              | `setfacl -m u:joao:r arquivo.txt`       |
| Remover permiss√£o                | `setfacl -x u:joao arquivo.txt`         |
| ACL padr√£o para diret√≥rios       | `setfacl -d -m u:ana:rw diretorio/`     |

---

### 10.4 Capabilities

| Exemplo                                                    | Descri√ß√£o                                                                 |
|------------------------------------------------------------|---------------------------------------------------------------------------|
| Descritores de arquivos abertos                            | Atuam como capacidades ap√≥s `open()`                                     |
| Linux `capsh`                                               | Define capacidades como `cap_net_bind_service`                           |
| Transfer√™ncia entre processos                              | `sendmsg()` envia descritor de arquivo via socket Unix                   |

---

### 10.5 DAC (Discretionary Access Control)

| Situa√ß√£o                            | Comando                             |
|------------------------------------|-------------------------------------|
| Criar arquivo com permiss√£o padr√£o | `touch file.txt`                    |
| Alterar permiss√µes                 | `chmod 600 file.txt`                |
| Alterar dono                       | `chown maria file.txt`              |

---

### 10.6 MAC (Mandatory Access Control)

| Sistema/Exemplo        | Descri√ß√£o                                                             |
|------------------------|----------------------------------------------------------------------|
| SELinux                | Controla acesso via contextos (`ls -Z`)                              |
| AppArmor               | Perfis de acesso em `/etc/apparmor.d/`                               |
| Android                | Apps com `permission labels` definidas no manifesto                 |

---

### 10.7 Pol√≠ticas de Acesso

| Pol√≠tica                      | Exemplo                                                         |
|------------------------------|------------------------------------------------------------------|
| Menor Privil√©gio             | Processo web n√£o roda como root                                 |
| Separa√ß√£o de Deveres         | Admin n√£o audita seus pr√≥prios logs                             |
| Media√ß√£o Completa            | Cada acesso passa por verifica√ß√£o                               |
| "Need to Know"               | Funcion√°rio s√≥ v√™ info do seu departamento                      |

---

### 10.8 Roles (RBAC)

| Papel         | Permiss√µes atribu√≠das                                       |
|---------------|-------------------------------------------------------------|
| Desenvolvedor | Acesso ao c√≥digo, compila√ß√£o                               |
| Gerente       | Acesso a relat√≥rios gerenciais                             |
| Contador      | Acesso a informa√ß√µes financeiras                           |
| M√©dico        | Acesso ao prontu√°rio dos pacientes                         |

Exemplo com `sudo`:
```bash
sudo -u programador make install
```

---

### 10.9 Escalonamento de Privil√©gios

| Tipo                          | Exemplo                                                           |
| ----------------------------- | ----------------------------------------------------------------- |
| setuid root                   | `passwd` altera `/etc/shadow`                                     |
| sudo                          | `sudo nano /etc/passwd`                                           |
| Explora√ß√£o de vulnerabilidade | Buffer overflow que concede shell root                            |
| Vertical vs Horizontal        | Vertical: user ‚Üí root; Horizontal: user1 acessa arquivos de user2 |